<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Game Hub</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<style>
:root{
  --bg:#050914;
  --card:#0e162a;
  --neon:#00ffff;
  --text:#ffffff;
}
*{box-sizing:border-box;font-family:Arial}
body{
  margin:0;
  background:radial-gradient(circle at top,#0f1e3d,var(--bg));
  color:var(--text);
}
#logo{
  width:100px;
  height:100px;
  border-radius:50%;
  display:block;
  margin:10px auto;
  cursor:pointer;
  object-fit:cover;
  border:2px solid var(--neon);
  transition:0.3s;
}
#logo:hover{
  box-shadow:0 0 20px var(--neon);
  transform:scale(1.1);
}
.admin{color:gold;font-weight:bold}

@media(max-width:900px){
  body::before{
    content:"üö´ COMPUTER ONLY";
    position:fixed;inset:0;
    background:black;
    display:grid;
    place-items:center;
    font-size:2rem;
    z-index:9999;
  }
}

#login{height:100vh;display:grid;place-items:center;}
.login-box{
  background:var(--card);
  padding:30px;
  border-radius:15px;
  box-shadow:0 0 25px var(--neon);
  width:300px;
}
.login-box input,button{
  width:100%;
  padding:10px;
  margin-bottom:10px;
  border:none;
  border-radius:8px;
}
.login-box button{background:var(--neon);font-weight:bold;cursor:pointer;}

#app{display:none}
header{
  background:#060b18;
  padding:12px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
}
header button{
  background:none;
  border:1px solid var(--neon);
  color:white;
  padding:8px 14px;
  cursor:pointer;
  border-radius:8px;
}
header button:hover{background:var(--neon);color:black;}
#searchBar{margin-left:auto;padding:8px;border-radius:8px;border:none;width:200px;}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:20px;
  margin:20px;
}
.card{
  background:var(--card);
  padding:20px;
  border-radius:15px;
  text-align:center;
  cursor:pointer;
  transition:0.3s;
  position:relative;
}
.card:hover{transform:scale(1.05);box-shadow:0 0 25px var(--neon);}
.card img{width:100%;height:100px;object-fit:cover;border-radius:10px;margin-bottom:10px;}
.favorite{color:gold;cursor:pointer;font-size:1.5rem;position:absolute;top:10px;right:10px;}
iframe{width:100%;height:80vh;border:none;}

#chatBox{background:#111;padding:10px;height:200px;overflow-y:auto;border-radius:10px;margin-top:10px;}
#chatInput{width:75%;padding:10px;border-radius:8px;border:none;}
#chatSend{padding:10px;background:var(--neon);border:none;border-radius:8px;cursor:pointer;}
#leaderboard{margin-top:20px;background:#111;padding:10px;border-radius:10px;}
</style>
</head>
<body>

<img id="logo" src="https://i.imgur.com/4b1852c6.png" onclick="goHome()">

<div id="login">
  <div class="login-box">
    <h2>Login</h2>
    <input id="username" placeholder="Username">
    <input id="pw" type="password" placeholder="Password">
    <button onclick="login()">Enter</button>
    <p id="err"></p>
  </div>
</div>

<div id="app">
<header>
  <button onclick="showCategory('classic')">Classic</button>
  <button onclick="showCategory('action')">Action & Racing</button>
  <button onclick="showCategory('horror')">Horror</button>
  <button onclick="showCategory('study')">Study</button>
  <button id="adminBtn" onclick="adminPanel()" style="display:none;">Admin üëë</button>
  <input type="text" id="searchBar" placeholder="Search games..." oninput="filterGames()">
</header>

<div id="game"></div>
<div id="chatBox"></div>
<input id="chatInput"><button id="chatSend">Send</button>

<div id="leaderboard">
  <h2>üèÜ Leaderboard</h2>
  <div id="leaderboardList"></div>
</div>
</div>

<script>
const firebaseConfig={
  apiKey:"AIzaSyBux7pWgXvmyUTtJ3xdqe9ittaIBQiSDB4",
  authDomain:"game-hub-9bf71.firebaseapp.com",
  projectId:"game-hub-9bf71",
  storageBucket:"game-hub-9bf71.firebasestorage.app",
  messagingSenderId:"308811078371",
  appId:"1:308811078371:web:cde710dbb1ead5d1c543d6",
  measurementId:"G-SY43VEEP0P"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();
const auth=firebase.auth();

const PASSWORD="Gamehub321";
const ADMIN_PASSWORD="BughaFortnite1";

let username,isAdmin=false,currentGame=null,startTime=null,favorites=[];

const appDiv=document.getElementById('app');
const loginDiv=document.getElementById('login');
const gameDiv=document.getElementById('game');
const chatBox=document.getElementById('chatBox');
const chatInput=document.getElementById('chatInput');
const chatSend=document.getElementById('chatSend');
const leaderboardList=document.getElementById('leaderboardList');
const adminBtn=document.getElementById('adminBtn');

const games=[
  {name:'Basketball Stars',url:'https://basketball-stars.io/',icon:'basketball-stars.png',category:'classic'},
  {name:'Geometry Dash',url:'https://geometrylitepc.io/',icon:'geometry-dash.png',category:'classic'},
  {name:'Slope',url:'https://slopegame.io',icon:'slope.png',category:'classic'},
  {name:'Moto X3M',url:'https://motox3m-free.github.io/',icon:'moto-x3m.png',category:'classic'},
  {name:'Bloxd.io',url:'https://bloxd.io/game/classic_survival',icon:'bloxd.png',category:'classic'},
  {name:'Zombs Royale',url:'https://zombsroyale.io/',icon:'zombs.png',category:'action'},
  {name:'Smash Karts',url:'https://smashkarts.io/',icon:'smash-karts.png',category:'action'},
  {name:'1v1.LOL',url:'https://1v1-lol.gitlab.io/',icon:'1v1lol.png',category:'action'},
  {name:'Krunker',url:'https://krunker.io/?game=DAL:349mg',icon:'krunker.png',category:'action'},
  {name:'Kogama',url:'https://www.kogama.com/',icon:'kogama.png',category:'action'},
  {name:'Soccer Bros',url:'https://soccer-bros.github.io/',icon:'soccer-bros.png',category:'action'},
  {name:'Sandbox City',url:'https://sandboxcity.net/',icon:'sandbox-city.png',category:'action'},
  {name:'Veck.io',url:'https://geometrylitepc.io/veck-io',icon:'veck.png',category:'action'},
  {name:'OpenFront',url:'https://openfront.io/',icon:'openfront.png',category:'action'},
  {name:'Subway Surfers',url:'https://azgames.io/subway-surfers',icon:'subway-surfers.png',category:'action'},
  {name:'Voxiom',url:'https://voxiom.io/',icon:'voxiom.png',category:'action'},
  {name:'Granny',url:'https://granny-games.com/',icon:'granny.png',category:'horror'},
  {name:'FNAF',url:'https://fnafgames.io/',icon:'fnaf.png',category:'horror'},
  {name:'FNAF 2',url:'https://fnaf-2.io/',icon:'fnaf2.png',category:'horror'},
  {name:'Sister Location',url:'https://fngames.io/five-nights-at-freddys-sister-location',icon:'sister-location.png',category:'horror'},
  {name:'Prison Escape',url:'https://www.crazygames.com/game/prison-escape-lnj',icon:'prison-escape.png',category:'action'},
  {name:'Exhibit of Sorrows',url:'https://www.crazygames.com/game/exhibit-of-sorrows',icon:'exhibit-of-sorrows.png',category:'action'},
  {name:'Seeing Things',url:'https://www.crazygames.com/game/seeing-things',icon:'seeing-things.png',category:'action'}
];

// ---------- LOGIN ----------
function login(){
  username=document.getElementById('username').value.trim();
  const pw=document.getElementById('pw').value;
  if(!username||!pw){document.getElementById('err').textContent='Enter username & password';return;}
  if(pw!==PASSWORD && pw!==ADMIN_PASSWORD){document.getElementById('err').textContent='Incorrect password';return;}
  isAdmin=pw===ADMIN_PASSWORD;
  const fakeEmail=username+'@gamehub.com';
  auth.signInWithEmailAndPassword(fakeEmail,pw).catch(()=>auth.createUserWithEmailAndPassword(fakeEmail,pw));
  loginDiv.style.display='none';
  appDiv.style.display='block';
  if(isAdmin) adminBtn.style.display='inline-block';
  showCategory('classic');
  updateLeaderboard();
}

// ---------- SHOW CATEGORY ----------
function showCategory(cat){
  saveTime();
  const filtered=games.filter(g=>g.category===cat);
  gameDiv.innerHTML='<div class="grid">'+filtered.map(g=>`
    <div class="card" onclick="loadGame('${g.name}','${g.url}')">
      <img src="icons/${g.icon}" alt="${g.name}">
      ${g.name}
      <span class="favorite" onclick="toggleFavorite(event,'${g.name}')">&#9733;</span>
    </div>`).join('')+'</div>';
}

// ---------- LOAD GAME ----------
function loadGame(name,url){
  saveTime();
  currentGame=name;
  startTime=Date.now();
  gameDiv.innerHTML=`<iframe src="${url}" id="gameFrame"></iframe>`;
  const iframe=document.getElementById('gameFrame');
  iframe.requestFullscreen?.();
}

// ---------- SAVE TIME ----------
function saveTime(){
  if(currentGame&&startTime){
    const sec=Math.floor((Date.now()-startTime)/1000);
    startTime=null;
  }
}

// ---------- FAVORITES ----------
function toggleFavorite(e,name){
  e.stopPropagation();
  const index=favorites.indexOf(name);
  if(index===-1) favorites.push(name);
  else favorites.splice(index,1);
  showCategory('classic');
}

// ---------- SEARCH ----------
function filterGames(){
  const term=document.getElementById('searchBar').value.toLowerCase();
  const visible=document.querySelectorAll('.card');
  visible.forEach(c=>{
    c.style.display=c.textContent.toLowerCase().includes(term)?'block':'none';
  });
}

// ---------- FULLSCREEN/ALT TOGGLE ----------
document.addEventListener('keydown',e=>{
  if(e.key==='Escape') document.exitFullscreen?.();
  if(e.altKey && !document.fullscreenElement){
    document.getElementById('gameFrame')?.requestFullscreen?.();
  }
});

// ---------- LEADERBOARD ----------
function updateLeaderboard(){
  db.collection("leaderboard").onSnapshot(snapshot=>{
    leaderboardList.innerHTML="";
    snapshot.forEach(doc=>{
      const user = doc.id;
      const plays = doc.data().plays || 0;
      db.collection("timePlayed").doc(user).get().then(timeDoc=>{
        let timeDetails="";
        if(timeDoc.exists){
          for(const g in timeDoc.data()){
            timeDetails += `${g}: ${timeDoc.data()[g]}s, `;
          }
        }
        leaderboardList.innerHTML += `<div><b>${user}${doc.data().admin?' üëë':''}</b> - Plays: ${plays} - Time: ${timeDetails}</div>`;
      });
    });
  });
}

// ---------- CHAT ----------
chatSend.onclick = ()=>{
  if(chatInput.value){
    auth.onAuthStateChanged(u=>{
      if(u){
        db.collection("chat").add({
          user: username,
          msg: chatInput.value,
          admin: isAdmin,
          time: Date.now()
        });
      }
    });
    chatInput.value='';
  }
};

db.collection("chat").orderBy("time").onSnapshot(snapshot=>{
  chatBox.innerHTML="";
  snapshot.forEach(doc=>{
    const data = doc.data();
    chatBox.innerHTML += `<div><b class="${data.admin?'admin':''}">${data.user}${data.admin?' üëë':''}:</b> ${data.msg}</div>`;
    chatBox.scrollTop = chatBox.scrollHeight;
  });
});

// ---------- ADMIN PANEL ----------
function adminPanel(){
  let html=`<h2>Admin Panel üëë</h2>`;
  html+=`<button onclick="forceStudy()">Force Study Mode</button> `;
  html+=`<button onclick="removeStudyMode()">Remove Study Mode</button> `;
  html+=`<h3>Online Users</h3><div id="onlineUsers"></div>`;
  gameDiv.innerHTML=html;

  db.collection("users").onSnapshot(s=>{
    const usersDiv = document.getElementById("onlineUsers");
    usersDiv.innerHTML="";
    s.forEach(d=>{
      const data=d.data();
      const userBtn=document.createElement("div");
      userBtn.innerHTML=`${d.id} ${data.role==='admin'?'(Admin)':''} 
      <button onclick="banUser('${d.id}')">Ban</button> 
      <button onclick="unbanUser('${d.id}')">Unban</button>`;
      usersDiv.appendChild(userBtn);
    });
  });
}

function forceStudy(){ db.collection("users").get().then(s=>s.forEach(d=>d.ref.update({studyMode:true}))); }
function removeStudyMode(){ db.collection("users").get().then(s=>s.forEach(d=>d.ref.update({studyMode:false}))); }

// Disable right click & F12
window.addEventListener('contextmenu',e=>e.preventDefault());
document.addEventListener('keydown',e=>{if(e.ctrlKey||e.key==='F12') e.preventDefault();});

</script>
</body>
</html>
